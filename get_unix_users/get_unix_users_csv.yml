---
        - name: Set facts for user, groups, hostname and ip
          set_fact:
            user_name: "{{ item.split(':')[0] }}"
            user_groups: "{{ item.split(':')[1].split(' ') }}"
            hostname: "{{ item.split(':')[2] }}"
            host_ip: "{{ item.split(':')[3] }}"

        - name: Create empty variable
          set_fact:
            csv_values: ""
        
        - name: Set values for the csv
          set_fact:
            csv_values: "{{ csv_values + '\"'+ user_group + '\",\"' + user_name + '\",\"' + hostname + '\",\"' + host_ip + '\";' | string }}"
          loop: "{{ user_groups }}"
          loop_control:
            loop_var: user_group

        - name: Remove additional semicolon
          set_fact:
            csv_values: "{{ (csv_values | regex_replace(';$','')).split(';') }}"

        - name: send content to csv file
          lineinfile:
            line: "{{ csv_value }}"
            dest: /tmp/users_unix_check.csv
            insertafter: EOF
          delegate_to: localhost
          loop: "{{ csv_values }}"
          loop_control:
            loop_var: csv_value
