---
        - name: (Re)Create empty file for storage of information
          local_action:
            module: copy
            dest: /tmp/users_unix_check.txt
            content: ''
          run_once: True

        - name: Get list of users in system
          shell: "cat /etc/passwd | grep -v '/sbin/[nologin|shutdown|halt]' | grep -v '/bin/[sync|false]' | cut -d: -f1"
          register: userlist

        - name: Get host's hostname
          command:  hostname
          register: hostname

        - name: Get groups for users
          shell: "groups {{ userlist.stdout_lines | join('\n') | replace('\n',' ') }}"
          register: grouplist

        - name: Remove spaces between colon
          set_fact:
            grouplist: "{{ grouplist.stdout_lines | regex_replace(' :\ ',':') }}"

        - name: Create empty variable
          set_fact:
            final_list: ""

        - name: Add hostname to list
          set_fact:
            final_list: "{{ final_list +  item + ':' + hostname.stdout + ':' + inventory_hostname + ';' | string }}"
          loop: "{{ grouplist }}"

        - name: Remove additional semi-colon
          set_fact: 
            final_list: "{{ (final_list | regex_replace(';$','')).split(';') }}"


        - name: send content to file
          lineinfile:
            line: "{{ item }}"
            dest: /tmp/users_unix_check.txt
            insertafter: EOF
          delegate_to: localhost
          loop: "{{ final_list }}"
