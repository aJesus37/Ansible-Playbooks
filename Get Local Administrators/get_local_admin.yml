---
    - name: Get users and groups in local administrators group
      hosts: windows
      gather_facts: no
      tasks:

        - name: (Re)Create empty file for storage of information
          local_action:
            module: copy
            dest: /tmp/administrators_windows_check.csv
            content: '"Machine","IP","Domain","User/Group"'
          run_once: True

        - name: Get users in local administrators group
          script:  /etc/ansible/scripts/Get-LocalAdmin.ps1 -IP "{{ inventory_hostname }}"
          register: administrators

        - name: Show content on screen
          debug: 
            msg: "{{ administrators.stdout }}"

        - name: send content to file
          lineinfile:
            line: "{{ administrators.stdout | string }}"
            dest: /tmp/administrators_windows_check.csv
            insertafter: EOF
          delegate_to: localhost

        - name: Remove empty lines in csv
          replace:
            path: /tmp/administrators_windows_check.csv
            regexp: '(^\s*$\n)'
            replace: ''
          delegate_to: localhost
          run_once: True